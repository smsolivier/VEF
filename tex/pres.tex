\documentclass[10pt]{beamer}

\usetheme[progressbar=frametitle]{metropolis}
% font options
\usefonttheme{professionalfonts}
\usepackage{appendixnumberbeamer}

\usepackage{booktabs}
\usepackage[scale=2]{ccicons}

\usepackage{pgfplots}
\usepgfplotslibrary{dateplot}

\usepackage{lmodern}

\usepackage{cancel}

\usepackage{color}

\usepackage{xspace}
\usepackage{siunitx}
\newcommand{\themename}{\textbf{\textsc{metropolis}}\xspace}

\usepackage[usestackEOL]{stackengine}

\title{Mixed Hybrid Finite Element Method Eddington Acceleration of Discrete Ordinates Source Iteration}
\subtitle{\normalsize ANS Student Conference \\ Mathematics and Computation}
% \date{\today}
\date{\today}
\author{Samuel S. Olivier }
\institute{Department of Nuclear Engineering, Texas A\&M University \\ \vfill
\centerline{\includegraphics[height=.75cm]{nuen-logo.png}}}
% \titlegraphic{\hfill\includegraphics[height=1.5cm]{nuen-logo.png}}

\newcommand{\SN}{S$_N$\xspace}
\renewcommand{\vec}[1]{\bm{#1}} %vector is bold italic
\newcommand{\vd}{\bm{\cdot}} % slightly bold vector dot
\newcommand{\grad}{\vec{\nabla}} % gradient
\newcommand{\ud}{\mathop{}\!\mathrm{d}} % upright derivative symbol
\newcommand{\pderiv}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\dderiv}[2]{\frac{\ud #1}{\ud #2}}
\newcommand{\edd}{\langle \mu^2 \rangle} 
\begin{document}

% make blocks fill 
\metroset{block=fill}

% dark background 
% \metroset{background=dark}

% color options
\definecolor{maroon}{RGB}{80,0,0}
\setbeamercolor{progress bar}{fg=maroon}
\setbeamercolor{progress bar in head/foot}{fg=maroon}
\setbeamercolor{progress bar in section page}{fg=maroon}

% \setbeamercolor{alerted text}{fg=maroon}

\maketitle

\begin{frame}{Overview }
  \setbeamertemplate{section in toc}[sections numbered]
  \tableofcontents[hideallsubsections]
\end{frame}

\section{Motivation}

\begin{frame}{Motivation}

	\footnotesize
	Radiation Hydrodynamics 
	\vspace{-.1in}
	    \begin{itemize}
	    	\item Couple radiation transport and fluid dynamics
	    	\item Material temperatures so high that fluid momentum and energy is altered by release of thermal radiation 
	    	\item Required in high energy density physics (National Ignition Facility, astrophysics)
	    \end{itemize}
    \vspace{-.05in}
    Radiation transport simulations are expensive and difficult to incorporate into hydro 

    Efficient methods developed independently 

    Mixed Hybrid Finite Element Method works well for hydrodynamics but is incompatible with radiation transport 

    Want to use MHFEM for hydrodynamics and Linear Discontinuous Galerkin for transport 

    \begin{block}{Goal}
        Develop an acceleration scheme that 
            \begin{enumerate} \vspace{-.1in}
                \item Robustly reduces the number of source iterations in Discrete Ordinates calculations 
                \item Increases compatibility with MHFEM multiphysics 
            \end{enumerate}
        \vspace{-.05in}
       	Show that MHFEM can be used to accelerate lumped LDG radiation transport 
    \end{block}

\end{frame}

\section{Source Iteration Background}

\begin{frame}{Boltzmann Equation}
    Steady-state, mono-energetic, istropically-scattering, fixed-source Linear Boltzmann Equation in 1D slab geometry:
    \begin{equation*}
        \mu \pderiv{\psi}{x}(x, \mu) + \Sigma_t(x) \psi(x,\mu) = 
        \frac{\Sigma_s(x)}{2} \int_{-1}^{1} \psi(x, \mu') d\mu' + \frac{Q(x)}{2}
    \end{equation*}

    $\mu = \cos \theta$ the cosine of the angle of flight $\theta$ relative to the $x$-axis

    $\Sigma_t(x)$, $\Sigma_s(x)$ total and scattering macroscopic cross sections 

    $Q(x)$ the isotropic fixed-source

    $\psi(x,\mu)$ the angular flux 

    % Factors of 1/2 come from 
    %     \begin{equation*}
    %         \phi(x) = \int_{-1}^{1} \psi(x,\mu) \ud \mu
    %     \end{equation*}

    \onslide<2>
    \vfill
    \centerline{\textbf{Integro-differential equation}}

\end{frame}

\begin{frame}{Discrete Ordinates Angular Discretization}

    Compute angular flux on $N$ discrete angles defined by Gauss Quadrature 
    \begin{equation*}
        \psi(x,\mu) \xrightarrow{\text{S}_N} 
        \begin{cases}
            \psi_1(x), & \mu = \mu_1 \\ 
            \psi_2(x), & \mu = \mu_2 \\ 
            \vdots \\ 
            \psi_N, & \mu = \mu_N 
        \end{cases}
    \end{equation*}

    $\mu_1$, $\mu_2$, $\dots$, $\mu_N$ defined by $N$-point Gauss Quadrature Rule 

    Integrate order $N-1$ polynomials exactly with 
    \begin{equation*}
        \phi(x) = \int_{-1}^1 \psi(x, \mu) \ud\mu 
            \xrightarrow{\text{S}_N} \sum_{n=1}^N 
            w_n \psi_n(x)
    \end{equation*}

\end{frame}

\begin{frame}{\SN Equations}

    \begin{equation*}
        \mu_n \dderiv{\psi_n}{x}(x) + \Sigma_t(x) \psi_n(x) = 
        \frac{\Sigma_s(x)}{2} \phi(x) + \frac{Q(x)}{2} \,, \, 1 \leq n \leq N
    \end{equation*}

    \begin{equation*}
        \phi(x) = \sum_{n=1}^N w_n \psi_n(x)
    \end{equation*}

    \vfill
    \centerline{\textbf{$N$ coupled, ordinary differential equations}}

\end{frame}

\begin{frame}{Source Iteration}

    Decouple by lagging scattering term 
    \begin{equation*}
        \mu_n \dderiv{\psi_n^{\ell+1}}{x}(x) + \Sigma_t(x) \psi_n^{\ell+1}(x) = 
        \frac{\Sigma_s(x)}{2} \phi^{\ell}(x) + \frac{Q(x)}{2} \,, 1 \leq n \leq N        
    \end{equation*}

    \textbf{$N$ independent, first-order, ordinary differential equations}

    \begin{exampleblock}{Source Iteration}
    \begin{enumerate}
        \item Given previous estimate for $\phi^{\ell}(x)$, solve for $\psi_n^{\ell+1}$

        \item Compute $\phi^{\ell+1}(x) = 
            \sum_{n=1}^N w_n \psi_n^{\ell+1}(x)$ 

        \item Update scattering term with $\phi^{\ell+1}(x)$ and repeat until: 
             \begin{equation*}
                \frac{\|\phi^{\ell+1}(x) - \phi^{\ell}(x)\|}{\|\phi^{\ell+1}(x)\|} < \epsilon 
             \end{equation*}

    \end{enumerate}
    \end{exampleblock}

\end{frame}

\begin{frame}{Need For Acceleration in Source Iteration}

	Convergence rate is linked to the number of collisions in a particle's lifetime

    If $\phi^0(x) = 0$
    \begin{equation*}
        \mu_n \dderiv{\psi_n^{1}}{x}(x) + \Sigma_t(x) \psi_n^{1}(x) =
        \vphantom{\cancelto{0}{\frac{\Sigma_s(x)}{2} \phi^{0}(x)}} 
        \only<+>{\frac{\Sigma_s(x)}{2} \phi^{0}(x)}
        \only<+>{\cancelto{0}{\frac{\Sigma_s(x)}{2} \phi^{0}(x)}}
         + \frac{Q(x)}{2} \,, 1 \leq n \leq N 
    \end{equation*}
    $\Rightarrow \phi^1(x) $ is the uncollided flux 

    $\phi^{\ell}(x)$ is the scalar flux of particles that have undergone at most $\ell - 1$ collisions 

    Each source iteration adds scattering information 

    \textbf{Slow to converge in optically thick systems with minimal losses to absorption and leakage}

\end{frame}

\begin{frame}{Diffusion Synthetic Acceleration}

    Large, highly scattering systems $\Rightarrow$ Diffusion Theory is accurate! 

    % bold acceleration additions

    \begin{exampleblock}{Diffusion Synthetic Acceleration}
    \begin{enumerate}
        \item Given previous estimate for $\phi^{\ell}(x)$, solve for $\psi_n^{\ell+1/2}$

        \item Compute $\phi^{\ell+1/2}(x) = 
            \sum_{n=1}^N w_n \psi_n^{\ell+1/2}(x)$ 

        \item \alert{Solve diffusion equation for a correction factor, $f^{\ell+1}(x)$}

        \item Update scattering term with 
            $\alert{\phi^{\ell+1}(x) = \phi^{\ell+1/2}(x) + f^{\ell+1}(x)}$ 
        and repeat until: 
             \begin{equation*}
                \frac{\|\phi^{\ell+1}(x) - \phi^{\ell}(x)\|}{\|\phi^{\ell+1}(x)\|} < \epsilon 
             \end{equation*}

    \end{enumerate}
    \end{exampleblock}

\end{frame}

\begin{frame}{DSA Problems}

    Becomes non-convergent in highly scattering media with coarse spatial grids 

    Transport and Diffusion steps must be consistently differenced 

    Consistently differenced equations are more expensive to solve 

    Transport and MHFEM are not compatible

    \onslide<2>
    \vfill 
    \centerline{\textbf{A new acceleration scheme is needed!}}

\end{frame}

\section{Eddington Acceleration}

\begin{frame}{Zeroth Angular Moment}

	Boltzmann Equation
	\begin{equation*}
	        \mu \dderiv{\psi}{x}(x, \mu) + 
	        \Sigma_t(x) \psi(x,\mu) = 
	        \frac{\Sigma_s(x)}{2} \phi(x) + 
	        \frac{Q(x)}{2} 
	\end{equation*}

	Integrate over all angles 
	\begin{equation*}
	    \int_{-1}^{1} \mu \dderiv{\psi}{x}(x, \mu) \ud \mu \ + 
	    \int_{-1}^{1} \Sigma_t(x) \psi(x,\mu) \ud \mu = 
	    \int_{-1}^{1} \frac{\Sigma_s(x)}{2} \phi(x) \ud \mu \ + 
	    \int_{-1}^{1} \frac{Q(x)}{2} \ud \mu 
	\end{equation*}

	Use $J(x) = \int_{-1}^{1} \mu \psi(x,\mu) \ud \mu$, 
		$\phi(x) = \int_{-1}^{1} \psi(x,\mu) \ud \mu$ 
	\begin{block}{Zeroth Angular Moment}
	\begin{equation*}
		\dderiv{}{x} J(x) + \Sigma_a(x) \phi(x) = Q(x)
	\end{equation*}
	\end{block}

\end{frame}

\begin{frame}{First Angular Moment}

	Multiply by $\mu$ and integrate 
	{\footnotesize
	\begin{equation*}
		\only<1,2,3>{
        \int_{-1}^{1} \mu^2 \dderiv{\psi}{x}(x, \mu) \ud \mu}
        \only<4>{\alert{\int_{-1}^{1} \mu^2 \dderiv{\psi}{x}(x, \mu) \ud \mu}} \ + 
        \vphantom{\underbrace{\int_{-1}^{1} \mu \Sigma_t(x) \psi(x,\mu) \ud \mu}_{
        	\Sigma_t(x) J(x)}}
        \only<1>{\int_{-1}^{1} \mu \Sigma_t(x) \psi(x,\mu) \ud \mu \ =}
        \only<2,3,4>{\underbrace{\int_{-1}^{1} \mu \Sigma_t(x) \psi(x,\mu) \ud \mu}_{
        	\Sigma_t(x) J(x)
        } \ =}
        \only<1,2>{
        \int_{-1}^{1} \mu \frac{\Sigma_s(x)}{2} \phi(x) \ud \mu \ + \ 
        \int_{-1}^{1} \mu \frac{Q(x)}{2}  \ud \mu }
        \only<3,4>{\underbrace{
	        \int_{-1}^{1} \mu \frac{\Sigma_s(x)}{2} \phi(x) \ud \mu + 
	        \int_{-1}^{1} \mu \frac{Q(x)}{2}  \ud \mu 
	    }_{\text{Isotropic} \Rightarrow 0}
        }
    \end{equation*}}

\end{frame}

\begin{frame}{Eddington Factor}

	\onslide<1->
	Rearrange derivative 
	\begin{equation*}
		\dderiv{}{x} \int_{-1}^{1} \mu^2 \psi(x,\mu) \ud \mu
	\end{equation*}

	\onslide<2->
	Multiply and divide by $\int_{-1}^{1} \psi(x,\mu) \ud \mu$
	\begin{equation*}
		\only<2>{\dderiv{}{x} \int_{-1}^{1} \psi(x,\mu) \ud \mu}
		\only<3->{\dderiv{}{x} \underbrace{\int_{-1}^{1} \psi(x,\mu) \ud \mu
			\vphantom{
				\frac{
					\int_{-1}^{1} \mu^2 \psi(x,\mu) \ud \mu
				}{
					\int_{-1}^{1} \psi(x,\mu) \ud \mu
				}
			}}_{
			\phi(x)
		}}
		\only<2>{
			\frac{
				\int_{-1}^{1} \mu^2 \psi(x,\mu) \ud \mu
			}{
				\int_{-1}^{1} \psi(x,\mu) \ud \mu
			}
		}
		\only<3->{\underbrace{\frac{
			\int_{-1}^{1} \mu^2 \psi(x,\mu) \ud \mu
		}{
			\int_{-1}^{1} \psi(x,\mu) \ud \mu
		}
		}_\text{Eddington Factor}
		}
		\vphantom{
			\underbrace{
			\frac{
				\int_{-1}^{1} \mu^2 \psi(x,\mu) \ud \mu
			}{
				\int_{-1}^{1} \psi(x,\mu) \ud \mu
			}
			}_{\edd(x)}
		}
	\end{equation*}

	\onslide<4->
	Eddington Factor 
	\begin{equation*}
		\edd(x) = \frac{\int_{-1}^1 \mu^2 \psi(x,\mu) \ud \mu}{
			\int_{-1}^1 \psi(x,\mu) \ud \mu
		}
	\end{equation*}

	\onslide<5->
	Shape function 

\end{frame}

\begin{frame}{Moment Equations}

	\begin{block}{Moment Equations}
	\begin{equation*}
		\dderiv{}{x} J(x) + \Sigma_a(x) \phi(x) = Q(x)
	\end{equation*}
	\begin{equation*}
		\dderiv{}{x} \edd(x) \phi(x) 
		+ \Sigma_t(x) J(x) = 0 
	\end{equation*}
	\end{block}

	Solve First Moment for $J(x)$ 
	\begin{equation*}
		J(x) = -\frac{1}{\Sigma_t(x)} \dderiv{}{x} \edd(x) \phi(x)
	\end{equation*}

	Combine Zero and First Moments $\Rightarrow$ Drift Diffusion Equation
		\begin{equation*}
			-\dderiv{}{x} \frac{1}{\Sigma_t(x)} \dderiv{}{x} \edd(x) \phi(x)
			+ \Sigma_a(x) \phi(x) = Q(x)
		\end{equation*}

	Fick's Law: set $\edd(x) = \frac{1}{3}$
	\begin{equation*}
		J(x) = -\frac{1}{3\Sigma_t(x)} \dderiv{}{x} \phi(x)
	\end{equation*}

\end{frame}

% \input{zeroMoment}

% \input{firstMoment}

\begin{frame}{S$_8$ v. Diffusion}

	Small system $\Rightarrow$ diffusion not expected to be accurate 
	\begin{center}
	\includegraphics[width=.45\paperwidth]{figs/dvs.pdf}
	\includegraphics[width=.45\paperwidth]{figs/edd.pdf}
	\end{center}

\end{frame}

\begin{frame}{S$_8$ v. Drift Diffusion}

	Use $\edd(x)$ from S$_8$ in Moment Equations
	\begin{center}
	\includegraphics[width=.5\paperwidth]{figs/corrected.pdf}
	\end{center}

	\centerline{\textbf{Drift Diffusion and \SN match!}}

\end{frame}

\begin{frame}{Eddington Acceleration}

    Use \SN to compute $\edd(x)$ and Moment Equations to find $\phi(x)$ 

    \begin{exampleblock}{Eddington Acceleration}
    \begin{enumerate}
        \item Given the previous estimate for the scalar flux, $\phi^{\ell}(x)$, solve for $\psi_n^{\ell+1/2}(x)$

        \item \alert{Compute $\edd^{\ell+1/2}(x)$ }

        \item \alert{Solve the Moment Equations for $\phi^{\ell+1}(x)$ 
        	using $\edd^{\ell+1/2}(x)$} 

        \item Update the scalar flux estimate with $\phi^{\ell+1}(x)$ and repeat the iteration process until the scalar flux converges
    \end{enumerate}
    \end{exampleblock}

\end{frame}

\begin{frame}{Eddington Acceleration Properties}
    
    Acceleration occurs due to: 
    \begin{enumerate}
    	\item Angular shape of the angular flux converges quickly $\Rightarrow$ Eddington factor quickly converges 

    	\item Solution to moment equations models all scattering events at once 

    	\item Dependence on source iterations to introduce scattering information is reduced

    \end{enumerate}

    Downside: produces 2 solutions (\SN and Drift Diffusion)

    Benefits 
    \begin{enumerate}
    	\item No need for consistent differencing $\Rightarrow$ transport and acceleration steps can be differenced with arbitrarily different methods 

        \item Moment Equations are conservative 

        \item Accelerates source iterations 

        \item Difference between \SN and Drift Diffusion solution can be used as a measure of iteration uncertainty 

    \end{enumerate}

\end{frame}

\section{Results}

\begin{frame}{Test Problem} 

	Slab with reflecting left boundary and vacuum right boundary 

    Thickness of \SI{20}{cm} 

    $\Sigma_t(x) = \SI{1}{cm^{-1}}$

    100 cells $\Rightarrow$ optical thickness of 20 and optical thickness per cell of 0.2 

    S$_8$ solved with lumped Linear Discontinuous Galerkin 

    Moment Equations solved with Mixed Hybrid Finite Element 

\end{frame}

\begin{frame}{Iterations to Convergence Comparison}

    \centerline{\includegraphics[width=.7\paperwidth]{figs/accel.pdf}}

    Accelerates between 2.5 and 650 times $\Rightarrow$ acceleration is occurring 

    Performs similarly to consistent acceleration scheme 

\end{frame}

\begin{frame}{Convergence Rate Comparison}

    \begin{center}

        \includegraphics[width=.45\paperwidth]{figs/converge_una.pdf}
        \includegraphics[width=.45\paperwidth]{figs/converge_acc.pdf}

    \end{center}

    \vfill
    \centerline{\textbf{Fast rate of convergence of $\edd(x)$ is transfered to $\phi(x)$}}

\end{frame}

% \begin{frame}{Diffusion Limit}

% 	Scale cross sections, source 
% 	\begin{equation*}
% 	\Sigma_t \rightarrow \frac{1}{\epsilon} \Sigma_t, \,
% 		\Sigma_a \rightarrow \epsilon \Sigma_a ,\,
% 		Q \rightarrow \epsilon Q
% 	\end{equation*}

% 	System becomes diffusive as $\epsilon \rightarrow 0$ 


% \end{frame}

\section{Conclusions}

\begin{frame}{Summary}

    Conclusions
    \begin{itemize} \vspace{-.1in}
        \item Scheme successfully accelerated source iteration in 1D slab geometry 

        \item Inherently compatible with rad-hydro multiphysics 

        \begin{itemize}
            \item Transport and acceleration steps can be discretized with arbitrarily different methods 
            \item Avoids consistency issues 
            \item Provides less expensive, conservative solution 
        \end{itemize}

        \item Proved Mixed Hybrid Finite Element Method can be used to accelerate lumped Linear Discontinuous Galerkin transport 

    \end{itemize}

    Future Work 
    \begin{itemize} \vspace{-.1in}
        \item Develop a rad-hydro algorithm 

        \begin{itemize}
            \item Make use of inexpensive Moment solution in operator split iterations 
        \end{itemize}

        \item Add discretization in energy 

        \item Higher dimensions 

        \item Anisotropic scattering 

    \end{itemize}

\end{frame}

% begin uncounted slides ---------------------------
\appendix

\begin{frame}{References}

    \nocite{adams,morel,llnl,alcouffe,mhfem,hydro}
    \small
    \setbeamertemplate{bibliography item}{\insertbiblabel}
    \bibliographystyle{siam}
    \bibliography{bibliography}

\end{frame}

\begin{frame}[standout]
  Questions?
\end{frame}

\end{document}
